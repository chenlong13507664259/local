name: Update mihomo.yaml

on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * *'

jobs:
  update_yaml:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Ensure local folder exists
        run: New-Item -ItemType Directory -Force -Path .\local

      - name: Download subs-check.exe
        run: Invoke-WebRequest -Uri "https://github.com/chenlong13507664259/local/releases/download/subs-check-1.0/subs-check.exe" -OutFile ".\local\subs-check.exe"

      - name: Run subs-check
        run: .\local\subs-check.exe -f .\local\config.yaml

      - name: Create or update Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: subs-check-1.0   # 每次可用新版本号
          name: subs-check-1.0
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload generated files to Release
        uses: softprops/action-gh-release@v1
        with:
          files: local/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
